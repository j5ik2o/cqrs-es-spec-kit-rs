# コードスタイルと規約

## Rust コーディング規約
### 命名規則
- **モジュール**: `snake_case`
- **型（構造体・列挙型・トレイト）**: `PascalCase`
- **関数・変数**: `snake_case`
- **定数**: `SCREAMING_SNAKE_CASE`
- **ライフタイム**: `'a`, `'b` など短い小文字

### フォーマット
- **ツール**: `rustfmt`（標準設定）
- **インデント**: 4 スペース
- **行長**: 100 文字推奨（rustfmt デフォルト）

### 品質基準
- **Clippy**: 警告ゼロを維持
- **型アノテーション**: 公開 API は明示的な型注釈必須
- **エラーハンドリング**: `Result<T, E>` 型で回復可能性を明示、`unwrap()` 禁止（テストコード除く）
- **ドキュメント**: 公開関数・構造体には `///` ドキュメントコメント必須

## アーキテクチャ規約
### 層分離
```
ドメイン層（domain/）
  ↑ 依存可能
ユースケース層（usecase/）
  ↑ 依存可能
インターフェースアダプタ層（adapter/）
  ↑ 依存可能
インフラストラクチャ層（infra/）
```

- **ドメイン層**: 外部ライブラリ依存禁止（標準ライブラリのみ）
- **ユースケース層**: ドメインのみ依存、インフラ・外部 API への直接依存禁止
- **アダプタ層**: ユースケースへのポート経由でのみ通信
- **インフラ層**: 具体的な技術実装（DynamoDB, MySQL, Redis 等）

### モジュール構成
- **集約単位**: ユーザー集約、注文集約など、DDD の集約ごとにモジュール分離
- **ユースケース**: 1 ユースケース = 1 アプリケーションサービス
- **イベント**: ドメインイベントは専用モジュールで管理、バージョン情報を含む

## テストコード規約
### テストファイル配置
- **単体テスト**: 各ファイル内の `#[cfg(test)] mod tests`
- **統合テスト**: `tests/` ディレクトリ（E2E テスト含む）

### テスト命名
- **関数名**: `test_<対象関数>_<条件>_<期待結果>`
  - 例: `test_create_user_with_valid_email_succeeds()`
- **Arrange-Act-Assert パターン**必須

### テストカバレッジ
- **ドメイン層・ユースケース層**: 80% 以上を目標
- **エラーケース**: すべての `Result::Err` 分岐を網羅

## Git コミットメッセージ
- **フォーマット**: `<仕様ID>: <ユースケース名> - <変更概要>`
  - 例: `US-001: ユーザー登録 - Email 値オブジェクト実装`
- **本文**: 変更理由と影響範囲を簡潔に記述

## ドキュメント同期規約
- **仕様書**: `specs/` 配下、変更時は同時更新必須
- **計画書**: `plan-template.md` 使用
- **タスク**: `tasks-template.md` 使用
- **憲章**: `.specify/memory/constitution.md` に準拠
- **乖離禁止**: 実装とドキュメントの不一致は PR でブロック
